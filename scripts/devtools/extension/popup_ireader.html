<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IReader Source Creator</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            width: 420px;
            font-family: system-ui, -apple-system, sans-serif;
            background: #1e1e2e;
            color: #f8fafc;
        }
        
        .header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            padding: 14px;
            text-align: center;
        }
        
        .header h1 { font-size: 16px; font-weight: 600; }
        
        .tabs {
            display: flex;
            background: #13131a;
            border-bottom: 1px solid #333;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            padding: 8px 4px;
            border: none;
            background: transparent;
            color: #888;
            font-size: 11px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            min-width: 60px;
        }
        
        .tab.active { color: #6366f1; border-bottom-color: #6366f1; }
        .tab:hover { color: #f8fafc; }
        
        .content { padding: 10px; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .section-title {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            color: #6366f1;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        
        .field-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .field-row:last-child { border-bottom: none; }
        
        .field-label { font-size: 11px; color: #ccc; }
        
        .field-value {
            font-family: monospace;
            font-size: 9px;
            color: #6366f1;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }
        
        .field-value:hover { color: #818cf8; }
        
        .field-actions { display: flex; gap: 3px; align-items: center; }
        
        .btn {
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-primary { background: #6366f1; color: white; }
        .btn-primary:hover { background: #5558e3; }
        
        .btn-secondary { background: rgba(255,255,255,0.1); color: #ccc; }
        .btn-secondary:hover { background: rgba(255,255,255,0.15); }
        
        .btn-danger { background: #ef4444; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        
        .btn-sm { padding: 3px 6px; font-size: 9px; }
        .btn-full { width: 100%; padding: 8px; font-size: 12px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        
        input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 7px 9px;
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            border-radius: 4px;
            color: #f8fafc;
            font-size: 11px;
            margin-bottom: 6px;
        }
        
        input:focus, select:focus { outline: none; border-color: #6366f1; }
        
        .help-text { font-size: 9px; color: #666; margin-bottom: 6px; }
        
        .page-info {
            background: rgba(0,0,0,0.3);
            padding: 8px 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-url {
            font-size: 9px;
            color: #888;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .page-type-select {
            padding: 4px 8px;
            font-size: 10px;
            background: #6366f1;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
        }
        
        /* Preview Card */
        .preview-card {
            background: linear-gradient(135deg, #2d2d3f, #1e1e2e);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .preview-header {
            font-size: 10px;
            color: #6366f1;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .preview-novel {
            display: flex;
            gap: 10px;
        }
        
        .preview-cover {
            width: 60px;
            height: 80px;
            background: #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: #666;
            overflow: hidden;
        }
        
        .preview-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-info { flex: 1; }
        .preview-title { font-size: 12px; font-weight: 600; margin-bottom: 4px; }
        .preview-author { font-size: 10px; color: #888; margin-bottom: 4px; }
        .preview-status { font-size: 9px; padding: 2px 6px; background: #10b981; border-radius: 10px; display: inline-block; }
        .preview-genres { font-size: 9px; color: #666; margin-top: 4px; }
        .preview-desc { font-size: 9px; color: #888; margin-top: 6px; max-height: 40px; overflow: hidden; }
        
        .preview-chapters {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #333;
        }
        
        .preview-chapter-item {
            font-size: 10px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
        }
        
        .preview-content {
            font-size: 10px;
            color: #ccc;
            line-height: 1.5;
            max-height: 100px;
            overflow: hidden;
        }
        
        /* Log */
        .log-entry {
            padding: 4px 6px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            gap: 6px;
            font-size: 9px;
        }
        
        .log-time { color: #666; flex-shrink: 0; }
        .log-msg { color: #ccc; word-break: break-word; }
        .log-entry.success .log-msg { color: #10b981; }
        .log-entry.error .log-msg { color: #ef4444; }
        .log-entry.info .log-msg { color: #6366f1; }
        .log-entry.warn .log-msg { color: #f59e0b; }
        
        /* AI Retry button */
        .btn-ai { background: #8b5cf6; color: white; }
        .btn-ai:hover { background: #7c3aed; }
    </style>
</head>
<body>
    <div class="header">
        <h1>IReader Source Creator</h1>
    </div>
    
    <div class="tabs">
        <button class="tab active" data-tab="general">General</button>
        <button class="tab" data-tab="details">Details</button>
        <button class="tab" data-tab="chapters">Chapters</button>
        <button class="tab" data-tab="explore">Explore</button>
        <button class="tab" data-tab="preview">Preview</button>
        <button class="tab" data-tab="log">Log</button>
        <button class="tab" data-tab="settings">Settings</button>
    </div>
    
    <div class="content">
        <div class="page-info">
            <div class="page-url" id="pageUrl">Loading...</div>
            <select class="page-type-select" id="pageTypeSelect">
                <option value="unknown">Unknown</option>
                <option value="novel-detail">Novel Detail</option>
                <option value="novel-list">Novel List</option>
                <option value="chapter-content">Chapter Content</option>
                <option value="search-results">Search Results</option>
            </select>
        </div>
        
        <!-- General Tab -->
        <div id="tab-general" class="tab-content active">
            <div class="section">
                <div class="section-title">Source Info</div>
                <input type="text" id="sourceName" placeholder="Source Name">
                <input type="text" id="lang" placeholder="Language (en)" value="en">
            </div>
            
            <div class="section">
                <div class="section-title">URLs</div>
                <p class="help-text">Use {{page}} for page number, {{query}} for search</p>
                <input type="text" id="latestUrl" placeholder="Latest: /novels?sort=latest&page={{page}}">
                <input type="text" id="popularUrl" placeholder="Popular: /novels?sort=popular&page={{page}}">
                <input type="text" id="searchUrl" placeholder="Search: /search?q={{query}}&page={{page}}">
            </div>
            
            <div class="section">
                <div class="section-title">Quick Actions</div>
                <div class="btn-grid">
                    <button class="btn btn-primary" id="btnAutoDetect">Auto-Detect</button>
                    <button class="btn btn-secondary" id="btnTestAll">Test All</button>
                </div>
                <button class="btn btn-ai btn-full" id="btnAiDetect" style="margin-top: 6px;">AI Detect (Current Page)</button>
            </div>
        </div>

        
        <!-- Details Tab -->
        <div id="tab-details" class="tab-content">
            <div class="section">
                <div class="section-title">Novel Details Page</div>
                
                <div class="field-row">
                    <span class="field-label">Title</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-title" title="Click to copy">-</span>
                        <button class="btn btn-primary btn-sm" data-field="title">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="title" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="title">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Author</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-author">-</span>
                        <button class="btn btn-primary btn-sm" data-field="author">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="author" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="author">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Description</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-description">-</span>
                        <button class="btn btn-primary btn-sm" data-field="description">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="description" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="description">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Cover</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-cover">-</span>
                        <button class="btn btn-primary btn-sm" data-field="cover">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="cover" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="cover">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Status</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-status">-</span>
                        <button class="btn btn-primary btn-sm" data-field="status">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="status" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="status">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Genres</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-genres">-</span>
                        <button class="btn btn-primary btn-sm" data-field="genres">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="genres" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="genres">AI</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chapters Tab -->
        <div id="tab-chapters" class="tab-content">
            <div class="section">
                <div class="section-title">Chapter List</div>
                <p class="help-text">Select ONE chapter - selector will match all</p>
                
                <div class="field-row">
                    <span class="field-label">Chapter Item</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-chapter-item">-</span>
                        <button class="btn btn-primary btn-sm" data-field="chapter-item">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="chapter-item" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="chapter-item">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Chapter Name</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-chapter-name">-</span>
                        <button class="btn btn-primary btn-sm" data-field="chapter-name">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="chapter-name" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="chapter-name">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Chapter Link</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-chapter-link">-</span>
                        <button class="btn btn-primary btn-sm" data-field="chapter-link">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="chapter-link" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="chapter-link">AI</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Chapter Content</div>
                
                <div class="field-row">
                    <span class="field-label">Content</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-content">-</span>
                        <button class="btn btn-primary btn-sm" data-field="content">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="content" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="content">AI</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Explore Tab -->
        <div id="tab-explore" class="tab-content">
            <div class="section">
                <div class="section-title">Novel List Page</div>
                
                <div class="field-row">
                    <span class="field-label">Novel Card</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-novel-item">-</span>
                        <button class="btn btn-primary btn-sm" data-field="novel-item">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="novel-item" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="novel-item">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Title</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-explore-title">-</span>
                        <button class="btn btn-primary btn-sm" data-field="explore-title">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="explore-title" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="explore-title">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Cover</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-explore-cover">-</span>
                        <button class="btn btn-primary btn-sm" data-field="explore-cover">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="explore-cover" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="explore-cover">AI</button>
                    </div>
                </div>
                
                <div class="field-row">
                    <span class="field-label">Link</span>
                    <div class="field-actions">
                        <span class="field-value" id="val-explore-link">-</span>
                        <button class="btn btn-primary btn-sm" data-field="explore-link">Select</button>
                        <button class="btn btn-warning btn-sm" data-region="explore-link" title="Select region for AI">üìç</button>
                        <button class="btn btn-ai btn-sm" data-ai-field="explore-link">AI</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Preview Tab -->
        <div id="tab-preview" class="tab-content">
            <div class="section">
                <div class="section-title">Live Preview</div>
                <button class="btn btn-primary btn-full" id="btnRefreshPreview">Refresh Preview</button>
            </div>
            
            <div class="preview-card" id="previewCard">
                <div class="preview-header">Novel Detail Preview</div>
                <div class="preview-novel">
                    <div class="preview-cover" id="previewCover">No Cover</div>
                    <div class="preview-info">
                        <div class="preview-title" id="previewTitle">Title not set</div>
                        <div class="preview-author" id="previewAuthor">Author: -</div>
                        <span class="preview-status" id="previewStatus">Unknown</span>
                        <div class="preview-genres" id="previewGenres">Genres: -</div>
                    </div>
                </div>
                <div class="preview-desc" id="previewDesc">Description not set</div>
                
                <div class="preview-chapters">
                    <div class="preview-header">Chapters Preview</div>
                    <div id="previewChapters">
                        <div class="preview-chapter-item">No chapters detected</div>
                    </div>
                </div>
            </div>
            
            <div class="preview-card" id="previewContentCard" style="margin-top: 10px;">
                <div class="preview-header">Content Preview</div>
                <div class="preview-content" id="previewContent">
                    Navigate to a chapter page to preview content
                </div>
            </div>
        </div>
        
        <!-- Log Tab -->
        <div id="tab-log" class="tab-content">
            <div class="section">
                <div class="section-title">Activity Log</div>
                <div id="logContainer" style="max-height: 250px; overflow-y: auto;">
                    <div style="color: #666; text-align: center; padding: 20px; font-size: 10px;">No activity yet</div>
                </div>
                <button class="btn btn-secondary btn-full" id="btnClearLog" style="margin-top: 6px;">Clear Log</button>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content">
            <div class="section">
                <div class="section-title">Gemini AI</div>
                <input type="password" id="geminiApiKey" placeholder="Gemini API Key">
                <div class="btn-grid">
                    <button class="btn btn-primary" id="btnSaveApiKey">Save Key</button>
                    <button class="btn btn-secondary" id="btnLoadModels">Load Models</button>
                </div>
                <div id="apiKeyStatus" style="font-size: 9px; margin-top: 6px; color: #888;"></div>
                
                <p class="help-text" style="margin-top: 10px;">Select Model</p>
                <select id="geminiModel">
                    <option value="">-- Load models first --</option>
                </select>
                <div id="modelInfo" style="font-size: 9px; color: #666;"></div>
            </div>
            
            <div class="section">
                <div class="section-title">Options</div>
                <label style="display: flex; align-items: center; gap: 6px; font-size: 11px; margin-bottom: 6px;">
                    <input type="checkbox" id="optReverseChapters" style="width: auto;">
                    <span>Reverse chapter order</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; font-size: 11px;">
                    <input type="checkbox" id="optAddBaseUrl" checked style="width: auto;">
                    <span>Add base URL to relative links</span>
                </label>
            </div>
            
            <div class="section">
                <button class="btn btn-danger btn-full" id="btnClearAll">Clear All Data</button>
            </div>
        </div>
        
        <!-- Export Section (always visible) -->
        <div class="section">
            <div class="btn-grid">
                <button class="btn btn-success btn-full" id="btnExportKotlin">Export Kotlin</button>
                <button class="btn btn-secondary btn-full" id="btnExportJSON">Export JSON</button>
            </div>
        </div>
    </div>
    
    <script src="popup_ireader.js"></script>
</body>
</html>
